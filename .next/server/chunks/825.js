"use strict";exports.id=825,exports.ids=[825],exports.modules={2563:(e,t,r)=>{r.d(t,{Z:()=>p});var i=r(4770),a=r.n(i);let o=new Uint8Array(256),l=o.length,s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,n=[];for(let e=0;e<256;++e)n.push((e+256).toString(16).substr(1));let c=function(e,t=0){let r=(n[e[t+0]]+n[e[t+1]]+n[e[t+2]]+n[e[t+3]]+"-"+n[e[t+4]]+n[e[t+5]]+"-"+n[e[t+6]]+n[e[t+7]]+"-"+n[e[t+8]]+n[e[t+9]]+"-"+n[e[t+10]]+n[e[t+11]]+n[e[t+12]]+n[e[t+13]]+n[e[t+14]]+n[e[t+15]]).toLowerCase();if(!("string"==typeof r&&s.test(r)))throw TypeError("Stringified UUID is invalid");return r},p=function(e,t,r){let i=(e=e||{}).random||(e.rng||function(){return l>o.length-16&&(a().randomFillSync(o),l=0),o.slice(l,l+=16)})();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=i[e];return t}return c(i)}},2825:(e,t,r)=>{r.d(t,{j:()=>o});var i=r(2563),a=r(6457);class o{constructor(e){this.client=e}async createFormFromPrompt(e,t={},r){let i=await this.parsePrompt(e),a={name:t.title||i.title,workspaceId:r,status:"PUBLISHED",blocks:i.blocks,settings:{language:"en",isClosed:!1,hasSelfEmailNotifications:!0,hasRespondentEmailNotifications:!1,hasProgressBar:!0,hasPartialSubmissions:!0,pageAutoJump:!1,saveForLater:!0,redirectOnCompletion:t.redirectUrl||i.redirectUrl||null,confirmationMessage:i.confirmationMessage||t.confirmationMessage||"Thank you for your submission!",styles:{theme:"LIGHT",font:{provider:"Google",family:"Roboto Slab"}}}};return await this.client.createForm(a)}async parsePrompt(e){let t=this.tryParseStructuredDefinition(e);if(t)return t;try{let t=await (0,a.J)(e),r=await this.convertLLMFormToBlocks(t);return{title:t.title,blocks:r,confirmationMessage:t.settings?.confirmationMessage,redirectUrl:t.settings?.redirectUrl??null}}catch(e){console.warn("LLM parsing failed, falling back to keyword parser:",e)}let r=e.toLowerCase(),i=this.extractTitle(e),o=this.parseFields(r,i);return{title:i,blocks:o}}extractTitle(e){let t=e.match(/create\s+(?:a\s+)?(?:simple\s+)?(?:contact\s+)?(?:survey\s+)?(?:registration\s+)?(?:feedback\s+)?(?:application\s+)?(?:.*?)\s+form/i);if(t){let e=t[0].replace(/create\s+(?:a\s+)?(?:simple\s+)?(?:contact\s+)?(?:survey\s+)?(?:registration\s+)?(?:feedback\s+)?(?:application\s+)?/i,"").replace(/\s+form/i,"");return this.capitalizeFirst(e.trim())}let r=e.match(/"([^"]+)"/);return r?r[1]:"Custom Form"}parseFields(e,t){let r=[];return r.push(this.createFormTitleBlock(t)),[{pattern:/\b(?:name|full name|first name|last name)\b/,type:"INPUT_TEXT",label:"Name",required:!0},{pattern:/\b(?:email|e-mail|email address)\b/,type:"INPUT_EMAIL",label:"Email",required:!0},{pattern:/\b(?:phone|telephone|mobile|cell|phone number)\b/,type:"INPUT_PHONE_NUMBER",label:"Phone Number",required:!1},{pattern:/\b(?:message|comment|feedback|suggestion|inquiry|question|note|description)\b/,type:"TEXTAREA",label:"Message",required:!0},{pattern:/\b(?:company|organization|business|firm|corporation)\b/,type:"INPUT_TEXT",label:"Company",required:!1},{pattern:/\b(?:address|location|street|city|zip|postal)\b/,type:"TEXTAREA",label:"Address",required:!1},{pattern:/\b(?:website|url|link|web)\b/,type:"INPUT_TEXT",label:"Website",required:!1},{pattern:/\b(?:age|number|quantity|amount|count)\b/,type:"INPUT_TEXT",label:"Number",required:!1},{pattern:/\b(?:date|birthday|birth|appointment|schedule)\b/,type:"INPUT_DATE",label:"Date",required:!1}].forEach(({pattern:t,type:i,label:a,required:o})=>{t.test(e)&&!r.some(e=>"LABEL"===e.type&&e.payload?.safeHTMLSchema?.[0]?.[0]?.toLowerCase()===a.toLowerCase())&&r.push(...this.createFieldBlocks({label:a,type:i,required:o,placeholder:`Enter ${a.toLowerCase()}`}))}),1===r.length&&[{type:"INPUT_TEXT",label:"Name",required:!0},{type:"INPUT_EMAIL",label:"Email",required:!0},{type:"TEXTAREA",label:"Message",required:!0}].forEach(({type:e,label:t,required:i})=>{r.push(...this.createFieldBlocks({label:t,type:e,required:i,placeholder:`Enter ${t.toLowerCase()}`}))}),r.push(this.createAttributionBlock()),r}createFormTitleBlock(e){return{uuid:(0,i.Z)(),type:"FORM_TITLE",groupUuid:(0,i.Z)(),groupType:"TEXT",payload:{title:e,safeHTMLSchema:[[e]]}}}async convertLLMFormToBlocks(e){let t=[],r=new Map;return t.push(this.createFormTitleBlock(e.title||"Custom Form")),e.description&&t.push(this.createContentBlock("TEXT",e.description)),e.sections&&e.sections.length>0&&e.sections.forEach((i,a)=>{i.title&&t.push(this.createContentBlock("HEADING_2",i.title)),i.description&&t.push(this.createContentBlock("TEXT",i.description)),i.fields&&i.fields.length>0&&i.fields.forEach(e=>{let i=this.convertLLMFieldToBlocks(e,r);i.length>0&&t.push(...i)}),a<e.sections.length-1&&t.push(this.createDividerBlock())}),t.push(this.createAttributionBlock()),t}createAttributionBlock(){let e=(0,i.Z)();return{uuid:(0,i.Z)(),type:"TEXT",groupUuid:e,groupType:"TEXT",payload:{safeHTMLSchema:[["This form has been prompted into existence with ",{href:"https://respiraformspro.com",target:"_blank",rel:"noopener noreferrer",style:"color:#0ea5e9; text-decoration:underline;"},"Respira Tally"]]}}}createFieldBlocks(e){let t=e.label,r=e.required??!1,a=(0,i.Z)(),o={uuid:(0,i.Z)(),type:"LABEL",groupUuid:a,groupType:"LABEL",payload:{safeHTMLSchema:[[t]]}},l={isRequired:r};return e.placeholder&&(l.placeholder=e.placeholder),e.extraPayload&&Object.assign(l,e.extraPayload),[o,{uuid:(0,i.Z)(),type:e.type,groupUuid:a,groupType:"QUESTION",payload:l}]}capitalizeFirst(e){return e.replace(/\b\w/g,e=>e.toUpperCase())}tryParseStructuredDefinition(e){let t=this.extractJsonString(e);if(!t)return null;try{let e=JSON.parse(t);if(!e||"object"!=typeof e)return null;let r=e.fields??e.blocks,i=Array.isArray(r)?r:[];if(0===i.length)return null;let a="string"==typeof e.title&&e.title.trim().length>0?e.title.trim():"Custom Form",o=[this.createFormTitleBlock(a)];if(i.forEach(e=>{let t=this.mapStructuredFieldToBlocks(e);t.length>0&&o.push(...t)}),1===o.length)return null;let l="string"==typeof e.confirmationMessage?e.confirmationMessage.trim():void 0,s="string"==typeof e.redirectUrl?e.redirectUrl.trim():void 0;return{title:a,blocks:o,confirmationMessage:l?.length?l:void 0,redirectUrl:s?.length?s:void 0}}catch{return null}}extractJsonString(e){let t=e.trim();if(t.startsWith("```")){let e=t.match(/```(?:json)?\s*([\s\S]*?)```/i);if(e&&e[1])return e[1].trim()}return t.startsWith("{")||t.startsWith("[")?t:null}mapStructuredFieldToBlocks(e){if(!e||"object"!=typeof e)return[];let t="string"==typeof e.label?e.label.trim():"",r="string"==typeof e.type?e.type.trim().toLowerCase():"",i={text:"INPUT_TEXT",short_text:"INPUT_TEXT",email:"INPUT_EMAIL",phone:"INPUT_PHONE_NUMBER",phone_number:"INPUT_PHONE_NUMBER",textarea:"TEXTAREA",long_text:"TEXTAREA",message:"TEXTAREA",date:"INPUT_DATE",url:"INPUT_TEXT",website:"INPUT_TEXT",link:"INPUT_TEXT",number:"INPUT_TEXT",select:"DROPDOWN",dropdown:"DROPDOWN",choice:"MULTIPLE_CHOICE",radio:"MULTIPLE_CHOICE",checkbox:"CHECKBOXES",multi_select:"CHECKBOXES",rating:"RATING",file:"FILE_UPLOAD",upload:"FILE_UPLOAD",file_upload:"FILE_UPLOAD",input_file_upload:"FILE_UPLOAD",signature:"SIGNATURE",sign:"SIGNATURE",heading:"HEADING_2",heading_1:"HEADING_1",heading1:"HEADING_1",h1:"HEADING_1",heading_2:"HEADING_2",heading2:"HEADING_2",h2:"HEADING_2",heading_3:"HEADING_3",heading3:"HEADING_3",h3:"HEADING_3",text_block:"TEXT",paragraph:"TEXT",content:"TEXT",description:"TEXT",divider:"DIVIDER",separator:"DIVIDER",title:"FORM_TITLE",form_title:"FORM_TITLE"}[r];if(!i)return[];let a=t||this.capitalizeFirst(r.replace(/_/g," ")),o="string"==typeof e.placeholder&&e.placeholder.trim().length>0?e.placeholder.trim():void 0;!o&&this.supportsPlaceholder(i)&&(o=`Enter ${a.toLowerCase()}`);let l="boolean"==typeof e.required&&e.required,s=this.cleanPayload(e.payload)||{};if("RATING"===i){let t=this.parseNumber(e.max??e.maxRating??e.scale)??5;return this.createRatingBlocks({label:a,required:l,stars:t})}if("FILE_UPLOAD"===i){let t="boolean"==typeof e.allowMultiple?e.allowMultiple:"boolean"==typeof e.multiple?e.multiple:void 0;"boolean"==typeof t&&(s.allowMultiple=t);let r=this.parseNumber(e.maxFiles??e.maximumFiles);"number"==typeof r&&(s.maxFiles=r);let i=this.parseNumber(e.maxFileSize??e.sizeLimit??e.maxSize);"number"==typeof i&&(s.maxFileSize=i);let a=this.normalizeStringArray(e.acceptedTypes??e.fileTypes??e.accept);a.length>0&&(s.acceptedFileTypes=a)}if("SIGNATURE"===i){let t=this.parseNumber(e.strokeWidth??e.penWidth);"number"==typeof t&&(s.strokeWidth=t)}if("FORM_TITLE"===i){let t="string"==typeof e.text&&e.text.trim().length>0?e.text.trim():a,r=this.createFormTitleBlock(t);return Object.keys(s).length>0&&Object.assign(r.payload,s),[r]}if(["TEXT","HEADING_1","HEADING_2","HEADING_3"].includes(i)){let t="string"==typeof e.content&&e.content.trim().length>0?e.content.trim():"string"==typeof e.text&&e.text.trim().length>0?e.text.trim():a;if(!t)return[];let r=Object.keys(s).length>0?s:void 0;return[this.createContentBlock(i,t,r)]}if("DIVIDER"===i){let e=Object.keys(s).length>0?s:void 0;return[this.createDividerBlock(e)]}if("DROPDOWN"===i){let t=this.normalizeChoiceOptions(e.options);return 0===t.length?[]:this.createDropdownBlocks({label:a,required:l,options:t.map(e=>({label:e.label,text:e.label,value:e.value}))})}if(["MULTIPLE_CHOICE","CHECKBOXES"].includes(i)){let t=this.normalizeChoiceOptions(e.options);if(0===t.length)return[];let r=Object.keys(s).length>0?s:void 0;return this.createChoiceBlocks({label:a,type:i,required:l,options:t,placeholder:o,extraPayload:r})}this.supportsPlaceholder(i)||(o=void 0);let n=Object.keys(s).length>0?s:void 0;return this.createFieldBlocks({label:a,type:i,required:l,placeholder:o,extraPayload:n})}normalizeChoiceOptions(e){return Array.isArray(e)?e.map(e=>{if("string"==typeof e){let t=e.trim();return t.length>0?{label:t,value:t}:null}if(e&&"object"==typeof e){let t="string"==typeof e.label&&e.label.trim().length>0?e.label.trim():"string"==typeof e.value?e.value.trim():"";if(!t)return null;let r="string"==typeof e.value&&e.value.trim().length>0?e.value.trim():t,i="boolean"==typeof e.default&&e.default,a=this.cleanPayload(e.payload)||{};return"string"==typeof e.description&&e.description.trim().length>0&&(a.description=e.description.trim()),{label:t,value:r,default:i,...a}}return null}).filter(e=>null!==e):[]}createChoiceBlocks(e){let t=(0,i.Z)(),r={uuid:(0,i.Z)(),type:"LABEL",groupUuid:t,groupType:"LABEL",payload:{safeHTMLSchema:[[e.label]]}},a="DROPDOWN"===e.type?"DROPDOWN_OPTION":"MULTIPLE_CHOICE"===e.type?"MULTIPLE_CHOICE_OPTION":"MULTI_SELECT_OPTION",o=e.options.map(e=>({uuid:(0,i.Z)(),type:a,groupUuid:t,groupType:a,payload:{label:e.label,text:e.text,value:e.value,isDefault:e.default??!1}})),l={isRequired:e.required,options:e.options.map(e=>({label:e.label,text:e.text,value:e.value})),placeholder:e.placeholder||void 0};return"CHECKBOXES"===e.type&&(l.allowMultipleSelections=!0),e.extraPayload&&Object.assign(l,e.extraPayload),[r,{uuid:(0,i.Z)(),type:e.type,groupUuid:t,groupType:e.type,payload:l},...o]}createContentBlock(e,t,r){let a={safeHTMLSchema:[[t]]};return"TEXT"===e?a.text=t:a.title=t,r&&Object.assign(a,r),{uuid:(0,i.Z)(),type:e,groupUuid:(0,i.Z)(),groupType:e,payload:a}}createDividerBlock(e){let t=e?{...e}:{};return{uuid:(0,i.Z)(),type:"DIVIDER",groupUuid:(0,i.Z)(),groupType:"DIVIDER",payload:t}}createRatingBlocks(e){let t=(0,i.Z)(),r=(0,i.Z)();return[{uuid:(0,i.Z)(),type:"TITLE",groupUuid:t,groupType:"QUESTION",payload:{safeHTMLSchema:[[e.label]]}},{uuid:(0,i.Z)(),type:"RATING",groupUuid:r,groupType:"RATING",payload:{isRequired:e.required,stars:e.stars}}]}createDropdownBlocks(e){let t=(0,i.Z)(),r=(0,i.Z)();return[{uuid:(0,i.Z)(),type:"TITLE",groupUuid:t,groupType:"QUESTION",payload:{safeHTMLSchema:[[e.label]]}},...e.options.map((t,a)=>({uuid:(0,i.Z)(),type:"DROPDOWN_OPTION",groupUuid:r,groupType:"DROPDOWN",payload:{index:a,isRequired:e.required,isFirst:0===a,isLast:a===e.options.length-1,text:t.text}}))]}supportsPlaceholder(e){return["INPUT_TEXT","INPUT_EMAIL","INPUT_PHONE_NUMBER","INPUT_DATE","TEXTAREA","DROPDOWN"].includes(e)}cleanPayload(e){if(!(!e||"object"!=typeof e||Array.isArray(e)))return{...e}}parseNumber(e){if("number"==typeof e&&Number.isFinite(e))return e;if("string"==typeof e&&e.trim().length>0){let t=Number(e.trim());if(Number.isFinite(t))return t}}normalizeStringArray(e){return Array.isArray(e)?e.map(e=>"string"==typeof e?e.trim():null!=e?String(e).trim():"").filter(Boolean):[]}convertLLMFieldToBlocks(e,t){let r=e.label?.trim()||this.capitalizeFirst(e.type.replace(/_/g," ")),i=r.toLowerCase(),a=e.required??!1,o=e.placeholder?.trim(),l=[],s=e=>e&&0!==e.length?e.map(e=>{let t=e.trim();if(!t.length)return null;let r=this.capitalizeFirst(t);return{label:r,text:r,value:t.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_|_$/g,"")||r}}).filter(e=>null!==e):[];switch(e.type){case"text":default:l=this.createFieldBlocks({label:r,type:"INPUT_TEXT",required:a,placeholder:o});break;case"email":l=this.createFieldBlocks({label:r,type:"INPUT_EMAIL",required:a,placeholder:o});break;case"phone":l=this.createFieldBlocks({label:r,type:"INPUT_PHONE_NUMBER",required:a,placeholder:o||"Enter phone number"});break;case"textarea":l=this.createFieldBlocks({label:r,type:"TEXTAREA",required:a,placeholder:o});break;case"dropdown":case"select":case"single_select":case"dropdown_field":case"country_select":let n=s(e.options);l=n.length>0?this.createDropdownBlocks({label:r,required:a,options:n}):"country_select"===e.type?this.createDropdownBlocks({label:r,required:a,options:[{label:"United States",text:"United States",value:"US"},{label:"Canada",text:"Canada",value:"CA"},{label:"United Kingdom",text:"United Kingdom",value:"GB"},{label:"Germany",text:"Germany",value:"DE"},{label:"France",text:"France",value:"FR"},{label:"Australia",text:"Australia",value:"AU"},{label:"Japan",text:"Japan",value:"JP"},{label:"Other",text:"Other",value:"OTHER"}]}):this.createFieldBlocks({label:r,type:"INPUT_TEXT",required:a,placeholder:o||"Enter selection"});break;case"multiple_choice":case"radio":case"single_choice":case"binary_choice":let c=s(e.options);l=c.length>0?this.createChoiceBlocks({label:r,type:"MULTIPLE_CHOICE",required:a,options:c}):"binary_choice"===e.type?this.createChoiceBlocks({label:r,type:"MULTIPLE_CHOICE",required:a,options:[{label:"Yes",text:"Yes",value:"yes"},{label:"No",text:"No",value:"no"}]}):this.createFieldBlocks({label:r,type:"INPUT_TEXT",required:a,placeholder:o||"Enter choice"});break;case"checkboxes":case"checkbox":case"multi_select":case"multiple_select":case"consent_checkbox":let p=s(e.options);l=p.length>0?this.createChoiceBlocks({label:r,type:"CHECKBOXES",required:a,options:p}):"consent_checkbox"===e.type?this.createChoiceBlocks({label:r,type:"CHECKBOXES",required:a,options:[{label:"I agree to the terms and conditions",text:"I agree to the terms and conditions",value:"consent"}]}):this.createFieldBlocks({label:r,type:"INPUT_TEXT",required:a,placeholder:o||"Enter selections"});break;case"rating":case"star_rating":l=this.createRatingBlocks({label:r,required:a,stars:e.maxRating??5});break;case"linear_scale":case"nps":case"scale":case"likert_scale":l=this.createFieldBlocks({label:r,type:"LINEAR_SCALE",required:a,extraPayload:{minValue:e.minValue??("nps"===e.type?0:1),maxValue:e.maxValue??("nps"===e.type?10:e.maxRating??5),minLabel:e.minLabel??("nps"===e.type?"Not likely":"likert_scale"===e.type?"Strongly Disagree":"Lowest"),maxLabel:e.maxLabel??("nps"===e.type?"Very likely":"likert_scale"===e.type?"Strongly Agree":"Highest"),step:e.step??1}});break;case"date":l=this.createFieldBlocks({label:r,type:"INPUT_DATE",required:a,placeholder:o});break;case"file_upload":case"file":case"upload":case"attachment":l=this.createFieldBlocks({label:r,type:"FILE_UPLOAD",required:a,extraPayload:{maxFileSize:"number"==typeof e.maxFileSize?Math.round(1048576*e.maxFileSize):void 0,acceptedFileTypes:e.allowedFileTypes}});break;case"signature":l=this.createFieldBlocks({label:r,type:"SIGNATURE",required:a});break;case"number":l=this.createFieldBlocks({label:r,type:"INPUT_TEXT",required:a,placeholder:o||"Enter number"});break;case"url":l=this.createFieldBlocks({label:r,type:"INPUT_TEXT",required:a,placeholder:o||"Enter URL"})}if(0===l.length)return l;let u=l[l.length-1];if(t.set(i,u.uuid),e.showIf){let r=this.parseConditionalLogic(e.showIf,t);r&&(u.payload={...u.payload,conditionalLogic:r})}return l}parseConditionalLogic(e,t){let r=e.match(/^(.+?)\s*(<=|>=|<|>|=|equals?)\s*(.+)$/i);if(!r)return console.warn("Could not parse conditional logic expression:",e),null;let[,i,a,o]=r,l=i.trim().toLowerCase(),s=t.get(l);if(!s)return console.warn("Conditional logic references unknown field:",l),null;let n={"<=":"LESS_THAN_OR_EQUAL_TO",">=":"GREATER_THAN_OR_EQUAL_TO","<":"LESS_THAN",">":"GREATER_THAN","=":"EQUALS",equals:"EQUALS"}[a.trim().toLowerCase()];if(!n)return console.warn("Unsupported conditional operator:",a),null;let c=Number(o.trim());return{action:"SHOW",conditions:[{questionId:s,operator:n,value:Number.isFinite(c)?c:o.trim()}]}}async createContactForm(e,t={}){let{title:r="Contact Form",includePhone:a=!1,includeCompany:o=!1}=t,l=[{uuid:(0,i.Z)(),type:"FORM_TITLE",groupUuid:(0,i.Z)(),groupType:"TEXT",payload:{title:r,safeHTMLSchema:[[r]]}}],s=e=>{l.push(...this.createFieldBlocks({label:e.label,type:e.type,required:e.required,placeholder:e.placeholder}))};return s({label:"Name",type:"INPUT_TEXT",required:!0,placeholder:"Enter your full name"}),s({label:"Email",type:"INPUT_EMAIL",required:!0,placeholder:"Enter your email address"}),a&&s({label:"Phone Number",type:"INPUT_PHONE_NUMBER",placeholder:"Enter your phone number"}),o&&s({label:"Company",type:"INPUT_TEXT",placeholder:"Enter your company name"}),s({label:"Message",type:"TEXTAREA",required:!0,placeholder:"Enter your message"}),await this.client.createForm({name:r,workspaceId:e,status:"PUBLISHED",blocks:l,settings:{language:"en",isClosed:!1,hasSelfEmailNotifications:!0,hasRespondentEmailNotifications:!1,hasProgressBar:!0,hasPartialSubmissions:!0,pageAutoJump:!1,saveForLater:!0,confirmationMessage:"Thank you for your message! We'll get back to you soon.",styles:{theme:"LIGHT",font:{provider:"Google",family:"Roboto Slab"}}}})}}},6457:(e,t,r)=>{r.d(t,{J:()=>a}),function(){var e=Error("Cannot find module 'groq-sdk'");throw e.code="MODULE_NOT_FOUND",e}();let i=null;async function a(e){console.log("\uD83D\uDD0D LLM Parsing - Checking Groq API key..."),console.log("GROQ_API_KEY exists:",!!process.env.GROQ_API_KEY),console.log("GROQ_API_KEY length:",process.env.GROQ_API_KEY?.length||0);let t=(!i&&process.env.GROQ_API_KEY&&(i=Object(function(){var e=Error("Cannot find module 'groq-sdk'");throw e.code="MODULE_NOT_FOUND",e}())({apiKey:process.env.GROQ_API_KEY})),i);if(!t)return console.log("❌ GROQ_API_KEY not found, falling back to basic parsing"),console.log("Available env vars:",Object.keys(process.env).filter(e=>e.includes("GROQ"))),o(e);console.log("✅ Groq client initialized, attempting LLM parsing...");let r=`You are an expert form designer with deep knowledge of Tally.so capabilities. Parse the user's request and create a comprehensive form structure.

Available field types (use ALL of these as appropriate):
- text: Single line text input
- email: Email address input with validation
- phone: Phone number input
- textarea: Multi-line text input
- dropdown: Dropdown selection (use instead of "select")
- multiple_choice: Single choice from options (use instead of "radio")
- checkboxes: Multiple choice from options (use instead of "checkbox")
- rating: Star rating (1-5 or 1-10)
- date: Date picker
- file_upload: File upload with size/type limits (use instead of "file")
- signature: Digital signature capture
- number: Numeric input
- url: URL input with validation

CONDITIONAL LOGIC SUPPORT:
- When the prompt mentions "if", "when", "show only if", or conditional behavior, create conditional fields
- Use "conditional" field type with "showIf" property to specify when fields should appear
- Example: "If rating ≤ 3, show textarea" → use conditional field with showIf condition

IMPORTANT: Use ALL field types as appropriate. Create multi-page forms with sections when the prompt suggests complexity. ALWAYS implement conditional logic when requested.

Return ONLY a valid JSON object with this structure:
{
  "title": "Form Title",
  "description": "Brief form description",
  "sections": [
    {
      "title": "Section Title",
      "description": "Section introduction text",
      "fields": [
        {
          "type": "field_type",
          "label": "Field Label",
          "required": true/false,
          "placeholder": "Optional placeholder",
          "description": "Optional field description",
          "options": ["Option 1", "Option 2"], // For dropdown/multiple_choice/checkboxes
          "maxRating": 5, // For rating fields
          "maxFileSize": 10, // For file_upload fields (MB)
          "allowedFileTypes": ["pdf", "doc", "docx"], // For file_upload fields
          "showIf": "field_name operator value" // For conditional fields (e.g., "satisfaction <= 3")
        }
      ]
    }
  ],
  "settings": {
    "confirmationMessage": "Thank you for your submission!",
    "redirectUrl": "https://example.com/thank-you",
    "hasProgressBar": true,
    "hasPartialSubmissions": true,
    "saveForLater": true
  }
}

Be intelligent about form structure and field types:

WITTY TITLE GENERATION:
- Create creative, engaging, and memorable form titles
- Use puns, alliteration, or clever wordplay when appropriate
- Match the tone to the form's purpose (professional, casual, fun, etc.)
- Examples:
  * Job Application → "Your Dream Job Awaits! Launch"
  * Customer Feedback → "Spill the Tea ☕️"
  * Event Registration → "Party Time! 🎉"
  * Survey → "Your Voice Matters 🎤"
  * Contact Form → "Let's Chat! 💬"
  * Feedback Form → "Tell Us What You Really Think 🤔"
  * Registration → "Join the Fun! 🎊"
  * Application → "Ready to Rock? 🎸"

COMPLEX FORMS & MULTI-PAGE:
- Create multiple sections for complex forms (e.g., "Personal Information", "Work Experience", "Additional Details")
- Add descriptive section introductions
- Use progress bars and partial submissions for long forms
- Group related fields logically

FIELD TYPE SELECTION:
- "rating" → rating field with appropriate scale
- "comments/feedback" → textarea
- "file upload/resume" → file field with appropriate limits
- "signature" → signature field
- "phone number" → phone field
- "website/URL" → url field
- "age/quantity" → number field
- "experience level" → select with options
- "multiple choice" → checkbox
- "single choice" → radio
- "date/birthday" → date field

JOB APPLICATION EXAMPLES:
- Personal Information section: name, email, phone, address
- Work Experience section: experience description, skills, resume upload
- Additional Information section: cover letter, availability, salary expectations

SURVEY EXAMPLES:
- Demographics section: age, location, occupation
- Experience section: rating questions, feedback textareas
- Additional section: open-ended questions, file uploads

EVENT REGISTRATION EXAMPLES:
- Attendee Information section: name, email, phone, dietary restrictions
- Event Preferences section: workshop selections, networking interests
- Payment section: payment method, special requests

CRITICAL: Create WITTY, CREATIVE, and ENGAGING titles that are fun and memorable! Examples:
- "Pizza Perfection Feedback Form" (not "Customer Feedback Form")
- "Event Registration Extravaganza" (not "Event Registration Form")
- "Job Application Adventure" (not "Job Application Form")
- "Survey of the Stars" (not "Customer Survey Form")
- "Feedback Fiesta" (not "Feedback Form")

Make titles playful, alliterative, and engaging while still being clear about the form's purpose!`;try{let i=await t.chat.completions.create({messages:[{role:"system",content:r},{role:"user",content:e}],model:"llama-3.1-8b-instant",temperature:.7,max_tokens:1e3}),a=i.choices[0]?.message?.content;if(console.log("\uD83D\uDD0D Raw LLM response:",a),!a)throw Error("No response from LLM");let o=a.match(/\{[\s\S]*\}/);if(console.log("\uD83D\uDD0D JSON match found:",!!o),!o)throw console.log("❌ No JSON found in response:",a),Error("No JSON found in LLM response");console.log("\uD83D\uDD0D Attempting to parse JSON:",o[0]);let l=JSON.parse(o[0]);if(console.log("✅ LLM parsed response:",JSON.stringify(l,null,2)),!l.title||!l.sections||!Array.isArray(l.sections))throw console.error("Invalid form structure from LLM:",l),Error("Invalid form structure from LLM");return console.log("✅ LLM parsing successful, returning:",l),l}catch(t){return console.error("❌ LLM parsing error:",t),console.log("\uD83D\uDD04 Falling back to basic parsing for prompt:",e),o(e)}}function o(e){console.log("Using basic parsing for prompt:",e);let t=function(e){let t=e.toLowerCase();return t.includes("customer feedback")?"Customer Feedback":t.includes("contact")?"Contact Form":t.includes("survey")?"Survey":t.includes("registration")?"Registration Form":t.includes("application")?"Application Form":"Custom Form"}(e),r=[],i=e.toLowerCase();return i.includes("rating")||i.includes("satisfied")||i.includes("scale")?r.push({type:"text",label:"Full Name",required:!0},{type:"email",label:"Email",required:!0},{type:"text",label:"Country",required:!0},{type:"rating",label:"How satisfied are you with our service?",required:!0,maxRating:5},{type:"textarea",label:"Please tell us what went wrong",required:!1,showIf:"how satisfied are you with our service? <= 3"},{type:"multiple_choice",label:"What did you like the most?",required:!1,options:["Speed","Quality","Support","Price"],showIf:"how satisfied are you with our service? >= 4"},{type:"multiple_choice",label:"Would you recommend us to a friend?",required:!0,options:["Yes","No"]},{type:"email",label:"Friend's email for referral",required:!1,showIf:"would you recommend us to a friend? = Yes"}):r.push({type:"text",label:"Name",required:!0},{type:"email",label:"Email",required:!0},{type:"textarea",label:"Message",required:!0}),{title:t,sections:[{title:"Information",description:"Please provide your details",fields:r}]}}}};