"use strict";(()=>{var e={};e.id=427,e.ids=[427],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7790:e=>{e.exports=require("assert")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2048:e=>{e.exports=require("fs")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},4175:e=>{e.exports=require("tty")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},1568:e=>{e.exports=require("zlib")},2577:(e,o,t)=>{t.r(o),t.d(o,{originalPathname:()=>y,patchFetch:()=>h,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var r={};t.r(r),t.d(r,{POST:()=>p});var s=t(9303),a=t(8716),l=t(670),i=t(7070),n=t(3374),c=t(2825);async function p(e){try{let{apiKey:o,prompt:t}=await e.json();if(!o||!t)return i.NextResponse.json({error:"API key and prompt are required"},{status:400});let r=new n.A(o),s=await r.validateApiKey();if(!s.isValid)return i.NextResponse.json({error:"Invalid API key",details:s.error},{status:401});let a=await r.listWorkspaces();if(0===a.length)return i.NextResponse.json({error:"No workspaces found"},{status:400});let l=a[0].id,p=new c.j(r);console.log("=== STEP 1: PARSING PROMPT ===");let d=await p.parsePrompt(t.trim());console.log("Parsed form blocks:",d.blocks.length),console.log("Parsed form title:",d.title),d.blocks.forEach((e,o)=>{console.log(`Block ${o}:`,{type:e.type,groupType:e.groupType,groupUuid:e.groupUuid,payloadKeys:Object.keys(e.payload||{}),hasLabel:"LABEL"===e.type,hasInput:["INPUT_TEXT","INPUT_EMAIL","TEXTAREA"].includes(e.type)})}),console.log("=== STEP 2: CREATING FORM ===");let u=await p.createFormFromPrompt(t.trim(),{title:void 0,confirmationMessage:"Thank you for your submission!"},l);console.log("Form created with ID:",u.id),console.log("=== STEP 3: RETRIEVING CREATED FORM ===");let g=await r.getForm(u.id);console.log("Retrieved form blocks count:",g.blocks?.length||0),console.log("Retrieved form has draft blocks:",g.hasDraftBlocks),g.blocks&&g.blocks.length>0?g.blocks.forEach((e,o)=>{console.log(`Retrieved Block ${o}:`,{type:e.type,groupType:e.groupType,groupUuid:e.groupUuid,payloadKeys:Object.keys(e.payload||{})})}):console.log("❌ NO BLOCKS RETRIEVED FROM TALLY!"),console.log("=== STEP 4: PUBLISHING FORM ===");let m=u;try{m=await r.updateForm(u.id,{status:"PUBLISHED"}),console.log("✅ Form published successfully")}catch(e){console.log("❌ Could not publish form:",e)}console.log("=== STEP 5: RETRIEVING PUBLISHED FORM ===");let y=await r.getForm(u.id);return console.log("Final form blocks count:",y.blocks?.length||0),i.NextResponse.json({success:!0,prompt:t,parsedForm:{title:d.title,blocksCount:d.blocks.length,blocks:d.blocks.map(e=>({type:e.type,groupType:e.groupType,groupUuid:e.groupUuid,payloadKeys:Object.keys(e.payload||{})}))},createdForm:{id:u.id,name:u.name,status:u.status},retrievedForm:{id:g.id,blocksCount:g.blocks?.length||0,hasDraftBlocks:g.hasDraftBlocks,blocks:g.blocks?.map(e=>({type:e.type,groupType:e.groupType,groupUuid:e.groupUuid,payloadKeys:Object.keys(e.payload||{})}))||[]},finalForm:{id:y.id,blocksCount:y.blocks?.length||0,hasDraftBlocks:y.hasDraftBlocks},summary:{blocksSent:d.blocks.length,blocksRetrieved:g.blocks?.length||0,blocksFinal:y.blocks?.length||0,formCreated:!!u.id,formPublished:"PUBLISHED"===m.status},formUrl:`https://tally.so/r/${u.id}`,editUrl:`https://tally.so/forms/${u.id}/edit`})}catch(e){return console.error("=== FULL DEBUG ERROR ==="),console.error("Error message:",e.message),console.error("Error stack:",e.stack),i.NextResponse.json({error:"Full debug failed",message:e.message,stack:e.stack?.substring(0,500)},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/debug-detailed-flow/route",pathname:"/api/debug-detailed-flow",filename:"route",bundlePath:"app/api/debug-detailed-flow/route"},resolvedPagePath:"/Users/akunay/VibeCoding/RESPIRA_TALLY/app/api/debug-detailed-flow/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:u,staticGenerationAsyncStorage:g,serverHooks:m}=d,y="/api/debug-detailed-flow/route";function h(){return(0,l.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},3374:(e,o,t)=>{t.d(o,{A:()=>s});var r=t(4263);class s{constructor(e){this.baseUrl="https://tally.so/api",this.apiKey=e,this.client=r.Z.create({baseURL:this.baseUrl,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json",Accept:"application/json"},timeout:3e4}),this.client.interceptors.response.use(e=>e,e=>{if(e.response)throw Error(`Tally API Error: ${e.response.status} - ${e.response.data?.message||e.message}`);if(e.request)throw Error("Network Error: Unable to connect to Tally API");throw Error(`Request Error: ${e.message}`)})}async validateApiKey(){try{let e=await this.client.get("/workspaces");if(e.data&&e.data.items&&e.data.items.length>0){let o=e.data.items[0],t={id:o.createdByUserId,email:"user@example.com",name:"API User",createdAt:o.createdAt,updatedAt:o.updatedAt};return{isValid:!0,user:t}}return{isValid:!1,error:"No workspaces found"}}catch(e){return{isValid:!1,error:e instanceof Error?e.message:String(e)}}}async getUser(){try{return(await this.client.get("/user")).data}catch(e){throw Error(`Failed to get user: ${e instanceof Error?e.message:String(e)}`)}}async listForms(){try{return(await this.client.get("/forms")).data.items}catch(e){throw Error(`Failed to list forms: ${e instanceof Error?e.message:String(e)}`)}}async getForm(e){try{return(await this.client.get(`/forms/${e}`)).data}catch(o){throw Error(`Failed to get form ${e}: ${o instanceof Error?o.message:String(o)}`)}}async debugFormCreation(e,o){try{console.log("=== DEBUGGING FORM CREATION ==="),console.log("Form ID:",e);let t=await this.getForm(e);console.log("Retrieved form:",JSON.stringify(t,null,2)),console.log("=== COMPARISON ==="),console.log("Sent blocks count:",o.length),console.log("Retrieved form blocks count:",t.blocks?.length||0),console.log("Has draft blocks:",t.hasDraftBlocks),t.blocks&&t.blocks.length>0?(console.log("Retrieved blocks:"),t.blocks.forEach((e,o)=>{console.log(`Retrieved Block ${o}:`,{type:e.type,groupType:e.groupType,payloadKeys:Object.keys(e.payload||{})})})):console.log("❌ NO BLOCKS RETRIEVED - This confirms the API limitation")}catch(e){console.error("Debug error:",e)}}async createForm(e){try{console.log("=== CREATING FORM ==="),console.log("Form data being sent to Tally:",JSON.stringify(e,null,2)),console.log("Number of blocks:",e.blocks?.length||0),e.blocks&&e.blocks.forEach((e,o)=>{console.log(`Block ${o}:`,{type:e.type,groupType:e.groupType,payloadKeys:Object.keys(e.payload||{}),hasOptions:!!e.payload?.options,optionsCount:e.payload?.options?.length||0})});let o=await this.client.post("/forms",e);return console.log("=== FORM CREATED SUCCESSFULLY ==="),console.log("Tally response:",o.data),console.log("Form ID:",o.data.id),console.log("Has draft blocks:",o.data.hasDraftBlocks),o.data}catch(e){throw console.error("=== FORM CREATION ERROR ==="),console.error("Error creating form:",e),e instanceof Error&&"response"in e&&console.error("Axios error details:",{status:e.response?.status,statusText:e.response?.statusText,data:e.response?.data,headers:e.response?.headers}),Error(`Failed to create form: ${e instanceof Error?e.message:String(e)}`)}}async updateForm(e,o){try{return(await this.client.patch(`/forms/${e}`,o)).data}catch(o){throw Error(`Failed to update form ${e}: ${o instanceof Error?o.message:String(o)}`)}}async deleteForm(e){try{return await this.client.delete(`/forms/${e}`),!0}catch(o){throw Error(`Failed to delete form ${e}: ${o instanceof Error?o.message:String(o)}`)}}async listSubmissions(e){try{return(await this.client.get(`/forms/${e}/submissions`)).data.items}catch(o){throw Error(`Failed to list submissions for form ${e}: ${o instanceof Error?o.message:String(o)}`)}}async getSubmission(e,o){try{return(await this.client.get(`/forms/${e}/submissions/${o}`)).data}catch(e){throw Error(`Failed to get submission ${o}: ${e instanceof Error?e.message:String(e)}`)}}async deleteSubmission(e,o){try{return await this.client.delete(`/forms/${e}/submissions/${o}`),!0}catch(e){throw Error(`Failed to delete submission ${o}: ${e instanceof Error?e.message:String(e)}`)}}async listWorkspaces(){try{return(await this.client.get("/workspaces")).data.items}catch(e){throw Error(`Failed to list workspaces: ${e instanceof Error?e.message:String(e)}`)}}async createWorkspace(e,o){try{return(await this.client.post("/workspaces",{name:e,slug:o})).data}catch(e){throw Error(`Failed to create workspace: ${e instanceof Error?e.message:String(e)}`)}}}}};var o=require("../../../webpack-runtime.js");o.C(e);var t=e=>o(o.s=e),r=o.X(0,[948,972,263,825],()=>t(2577));module.exports=r})();